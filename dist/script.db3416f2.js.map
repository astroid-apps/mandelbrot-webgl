{"version":3,"sources":["pinchTransform.js","drawCenter.js","PointerController.js","Viewer.js","mandelbrot.js","script.js"],"names":["getXY","m","i","j","x","a","c","e","y","b","d","f","XY","ctx","p0","p1","getTransform","invertSelf","p0s","si","sj","p0e","ei","ej","undefined","p1s","p1e","translate","vsi","vsj","vei","vej","k","ad","bc","transform","IJ","di","dj","drawCenter","size","width","height","save","resetTransform","ci","cj","lineWidth","beginPath","moveTo","lineTo","closePath","stroke","restore","PointerController","canvas","move","end","pointers","addEventListener","push","id","pointerId","offsetX","offsetY","length","pt","find","p","update","pointerend","window","reset","forEach","Viewer","element","view","draw","status","min","max","clientWidth","clientHeight","document","createElement","style","cursor","touchAction","appendChild","getContext","fillStyle","strokeStyle","scale","init","mtXY2IJ","mtIJ2XY","updateMatrix","clampXY","clampScale","Math","sqrt","movingUpdate","deltaY","info","s","toFixed","canvas2","ctx2","clearRect","drawImage","mandelbrot","cv","gl","vs","createShader","VERTEX_SHADER","shaderSource","compileShader","fs","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","useProgram","vij","getAttribLocation","enableVertexAttribArray","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","vertexAttribPointer","FLOAT","vxy","bl","tl","br","tr","drawArrays","TRIANGLE_STRIP","vw","getElementById","str","innerHTML"],"mappings":"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","file":"script.db3416f2.js","sourceRoot":"..\\src","sourcesContent":["/*\r\n\tpinchTransform\r\n\t2020/11/02 Viewerから切り離し\r\n*/\r\n\r\nconst getXY = function(m,i,j){\r\n\tconst x = m.a * i + m.c * j + m.e;\r\n\tconst y = m.b * i + m.d * j + m.f;\r\n\treturn {x,y};\r\n};\r\n\r\n//p0sがp0e、p1sがp1eに一致するように平行移動回転拡大(XY座標系で処理)\r\nconst XY = function(ctx,p0,p1){\r\n\t\r\n\tconst m = ctx.getTransform().invertSelf()\r\n\t\r\n\tconst p0s = getXY(m,p0.si,p0.sj);\r\n\tconst p0e = getXY(m,p0.ei,p0.ej);\r\n\t\r\n\t//p1が未指定の場合は、平行移動のみ\r\n\tif(p1 == undefined){\r\n\t\tctx.translate(p0e.x - p0s.x, p0e.y - p0s.y);\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tconst p1s = getXY(m,p1.si,p1.sj);\r\n\tconst p1e = getXY(m,p1.ei,p1.ej);\r\n\r\n\tctx.translate(p0e.x, p0e.y);\r\n\r\n\t//p0を中心としてvsがveに一致するように回転拡大する座標変換\r\n\t//移動前のp0→p1ベクトルvs、移動後のp0→p1ベクトルve\r\n\tconst vsi = p1s.x - p0s.x;\r\n\tconst vsj = p1s.y - p0s.y;\r\n\tconst vei = p1e.x - p0e.x;\r\n\tconst vej = p1e.y - p0e.y;\r\n\tconst k = 1 / (vsi * vsi + vsj * vsj);\r\n\tconst ad = vei * vsi + vej * vsj;\r\n\tconst bc = vej * vsi - vei * vsj;\r\n\tctx.transform(ad * k, bc * k, -bc * k, ad * k, 0, 0);\r\n\r\n\tctx.translate(-p0e.x, -p0e.y);\r\n\r\n\t//p0の位置を合わせる\r\n\tctx.translate(p0e.x - p0s.x, p0e.y - p0s.y);\r\n};\r\n\r\n\r\n//p0sがp0e、p1sがp1eに一致するように平行移動回転拡大(IJ座標系で処理)\r\nconst IJ = function(ctx,p0,p1){\r\n\t\r\n\t//p1が未指定の場合は、平行移動のみ\r\n\tif(p1 == undefined){\r\n\t\tctx.translate(p0.di,p0.dj);\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tctx.translate(p0.ei,p0.ej);\r\n\r\n\t//p0を中心としてvsがveに一致するように回転拡大する座標変換\r\n\t//移動前のp0→p1ベクトルvs、移動後のp0→p1ベクトルve\r\n\tconst vsi = p1.si - p0.si;\r\n\tconst vsj = p1.sj - p0.sj;\r\n\tconst vei = p1.ei - p0.ei;\r\n\tconst vej = p1.ej - p0.ej;\r\n\tconst k = 1 / (vsi * vsi + vsj * vsj);\r\n\tconst ad = vei * vsi + vej * vsj;\r\n\tconst bc = vej * vsi - vei * vsj;\r\n\tctx.transform(ad * k, bc * k, -bc * k, ad * k, 0, 0);\r\n\r\n\tctx.translate(-p0.ei,-p0.ej);\r\n\r\n\t//p0の位置を合わせる\r\n\tctx.translate(p0.di,p0.dj);\r\n};\r\n\r\nexport {XY,IJ};","/*\r\n\t画面中心の「＋」表示(IJ座標系で処理)\r\n\t2020/11/15 Map.jsから切り離し\r\n*/\r\n\r\nconst drawCenter = function(ctx,size,width,height){\r\n\tctx.save();\r\n\tctx.resetTransform();\r\n\r\n\tconst ci = width * 0.5;\r\n\tconst cj = height * 0.5;\r\n\r\n\tctx.lineWidth = 1.0;\r\n\t\r\n\tctx.beginPath();\r\n\tctx.moveTo(ci-size,cj);\r\n\tctx.lineTo(ci+size,cj);\r\n\tctx.moveTo(ci,cj-size);\r\n\tctx.lineTo(ci,cj+size);\r\n\tctx.closePath();\r\n\tctx.stroke();\r\n\r\n\tctx.restore();\r\n};\r\n\r\nexport {drawCenter};","/*\r\n\tPointerController\r\n\t2020/11/23 Canvasから切り離し\r\n*/\r\n\r\nconst PointerController = function(canvas,move,end){\r\n\t\r\n\t//クリックまたはタップされたポインターの位置\r\n\tlet pointers = [];\r\n\t\r\n\tcanvas.addEventListener(\"pointerdown\",function(e){\r\n\t\tpointers.push({\r\n\t\t\tid: e.pointerId,\r\n\t\t\tsi: e.offsetX,\r\n\t\t\tsj: e.offsetY,\r\n\t\t\tei: e.offsetX,\r\n\t\t\tej: e.offsetY,\r\n\t\t});\r\n\t});\r\n\t\r\n\t//該当するポインターの状態を更新する\r\n\tconst update = function(e){\r\n\t\tif(pointers.length == 0) return;\r\n\t\tconst pt = pointers.find(function(p){\r\n\t\t\treturn p.id == e.pointerId;\r\n\t\t});\r\n\t\t\r\n\t\t//最新位置\r\n\t\tpt.ei = e.offsetX;\r\n\t\tpt.ej = e.offsetY;\r\n\t\t\r\n\t\t//移動量\r\n\t\tpt.di = e.offsetX - pt.si;\r\n\t\tpt.dj = e.offsetY - pt.sj;\r\n\t};\r\n\t\r\n\tcanvas.addEventListener(\"pointermove\",function(e){\r\n\t\tmove(pointers);\r\n\t\tupdate(e);\r\n\t});\r\n\t\r\n\t//ポインター終了時の動作\r\n\tconst pointerend = function(e){\r\n\t\tend(pointers);\r\n\t\tpointers = [];\r\n\t};\r\n\t\r\n\twindow.addEventListener(\"pointerup\",pointerend);\r\n\twindow.addEventListener(\"pointercancel\",pointerend);\r\n\t\r\n\t\r\n\t//pointermoveイベント毎に描画する場合は必須\r\n\tthis.reset = function(){\r\n\t\tpointers.forEach(function(p){\r\n\t\t\tp.si = p.ei;\r\n\t\t\tp.sj = p.ej;\r\n\t\t\tp.di = 0;\r\n\t\t\tp.dj = 0;\r\n\t\t});\r\n\t};\r\n};\r\n\r\nexport {PointerController};","/*\r\n\tViewer\r\n\t2020/10/26 新規作成\r\n*/\r\n\r\nimport * as pt from \"./pinchTransform.js\";\r\nimport {drawCenter} from \"./drawCenter.js\";\r\nimport {PointerController} from \"./PointerController.js\";\r\n\r\n//表示画面\r\nconst Viewer = function(element,view,draw,status){\r\n\t\r\n\tif(!(\"min\" in view.x)) view.x.min = undefined;\r\n\tif(!(\"max\" in view.x)) view.x.max = undefined;\r\n\tif(!(\"min\" in view.y)) view.y.min = undefined;\r\n\tif(!(\"max\" in view.y)) view.y.max = undefined;\r\n\t\r\n\tconst width = element.clientWidth;\r\n\tconst height = element.clientHeight;\r\n\t\r\n\tconst canvas = document.createElement(\"canvas\");\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tcanvas.style.cursor = \"move\";\r\n\tcanvas.style.touchAction = \"none\";\r\n\telement.appendChild(canvas);\r\n\t\r\n\tconst ctx = canvas.getContext(\"2d\");\r\n\tctx.fillStyle = \"rgba(255,255,255,1.0)\";\r\n\tctx.strokeStyle = \"rgba(255,255,255,1.0)\";\r\n\t\r\n\t//拡大表示時のスムージング無効化\r\n//\tctx.imageSmoothingEnabled = false;\r\n//\tctx.mozImageSmoothingEnabled = false;\r\n//\tctx.webkitImageSmoothingEnabled = false;\r\n//\tctx.msImageSmoothingEnabled = false;\r\n\t\r\n\t//原点をcanvas中心に移動\r\n\tctx.translate(width * 0.5, height * 0.5);\r\n\t\r\n\t//縮尺[px/1]、Y軸を上下逆転\r\n\tctx.scale(view.scale.init, -view.scale.init);\r\n\t\r\n\t//画面中心の座標(X,Y)を設定\r\n\tctx.translate(-view.x.init, -view.y.init);\r\n\t\r\n\t//--------------------------------------------------\r\n\t//座標変換\r\n\t//--------------------------------------------------\r\n\t\r\n\tlet mtXY2IJ = ctx.getTransform();\r\n\tlet mtIJ2XY = ctx.getTransform().invertSelf();\r\n\t\r\n\t//getXY,getIJ,getScaleを呼び出す前に実行する必要あり\r\n\tconst updateMatrix = function(){\r\n\t\tmtXY2IJ = ctx.getTransform();\r\n\t\tmtIJ2XY = ctx.getTransform().invertSelf();\r\n\t};\r\n\t\r\n\tconst getXY = function(i,j){\r\n\t\tconst x = mtIJ2XY.a * i + mtIJ2XY.c * j + mtIJ2XY.e;\r\n\t\tconst y = mtIJ2XY.b * i + mtIJ2XY.d * j + mtIJ2XY.f;\r\n\t\treturn {x,y};\r\n\t};\r\n\t\r\n\tconst getIJ = function(x,y){\r\n\t\tconst i = mtXY2IJ.a * x + mtXY2IJ.c * y + mtXY2IJ.e;\r\n\t\tconst j = mtXY2IJ.b * x + mtXY2IJ.d * y + mtXY2IJ.f;\r\n\t\treturn {i,j};\r\n\t};\r\n\t\r\n\tconst getScale = function(){\r\n\t\treturn Math.sqrt(mtXY2IJ.a * mtXY2IJ.a + mtXY2IJ.b * mtXY2IJ.b);\r\n\t};\r\n\t\r\n\t//--------------------------------------------------\r\n\t//移動拡大制約\r\n\t//--------------------------------------------------\r\n\t\r\n\t//画面中心がxyの範囲内に収まるように移動\r\n\tconst clampXY = function(){\r\n\t\tupdateMatrix();\r\n\t\tconst p = getXY(width * 0.5,height * 0.5);\r\n\t\t\r\n\t\tlet x = p.x;\r\n\t\tlet y = p.y;\r\n\t\t\r\n\t\tif(view.x.min != undefined && x < view.x.min) x = view.x.min;\r\n\t\tif(view.x.max != undefined && x > view.x.max) x = view.x.max;\r\n\t\tif(view.y.min != undefined && y < view.y.min) y = view.y.min;\r\n\t\tif(view.y.max != undefined && y > view.y.max) y = view.y.max;\r\n\t\t\r\n\t\tctx.translate(p.x - x, p.y - y);\r\n\t};\r\n\t\r\n\t//p: 拡大中心位置(XY座標)\r\n\tconst clampScale = function(p){\r\n\t\tupdateMatrix();\r\n\t\tconst scale = getScale();\r\n\t\t\r\n\t\tlet k = 1;\r\n\t\t\r\n\t\tif(scale > view.scale.max) k = view.scale.max / scale;\r\n\t\tif(scale < view.scale.min) k = view.scale.min / scale;\r\n\t\t\r\n\t\tctx.translate(p.x, p.y);\r\n\t\tctx.scale(k,k);\r\n\t\tctx.translate(-p.x, -p.y);\r\n\t};\r\n\t\r\n\t//--------------------------------------------------\r\n\t//ポインターイベント\r\n\t//--------------------------------------------------\r\n\t\r\n\tconst pc = new PointerController(canvas,function(pointers){\r\n\t\t\r\n\t\tif(pointers.length == 1){\r\n\t\t\tmovingUpdate(pointers[0]);\r\n\t\t\t\r\n\t\t}else if(pointers.length == 2){\r\n\t\t\tmovingUpdate(pointers[0],pointers[1]);\r\n\t\t}\r\n\t\t\r\n\t},function(pointers){\r\n\t\t\r\n\t\t//座標変換を確定させる\r\n\t\tif(pointers.length == 1){\r\n\t\t\tpt.XY(ctx,pointers[0]);\r\n\t\t\t\r\n\t\t}else if(pointers.length == 2){\r\n\t\t\tpt.XY(ctx,pointers[0],pointers[1]);\r\n\t\t\t\r\n\t\t\t//ズーム制約\r\n\t\t\tconst ci = (pointers[0].si + pointers[1].si) * 0.5;\r\n\t\t\tconst cj = (pointers[0].sj + pointers[1].sj) * 0.5;\r\n\t\t\tupdateMatrix();\r\n\t\t\tclampScale(getXY(ci,cj));\r\n\t\t}\r\n\t\t\r\n\t\tclampXY();\r\n\t\tupdate();\r\n\t});\r\n\t\r\n\t//--------------------------------------------------\r\n\t//マウスホイールイベント(PC専用)\r\n\t//--------------------------------------------------\r\n\t\r\n\tcanvas.addEventListener(\"wheel\",function(e){\r\n\t\t\r\n\t\t//マウスの位置pを中心にk倍する\r\n\t\tupdateMatrix();\r\n\t\tconst p = getXY(e.offsetX,e.offsetY);\r\n\t\tconst k = e.deltaY < 0 ? 1.4 : 1 / 1.4;\r\n\t\t\r\n\t\tctx.translate(p.x,p.y);\r\n\t\tctx.scale(k,k);\r\n\t\tctx.translate(-p.x,-p.y);\r\n\t\t\r\n\t\tclampScale(p);\r\n\t\tclampXY();\r\n\t\tupdate();\r\n\t});\r\n\t\r\n\t\r\n\t//--------------------------------------------------\r\n\t//status表示(現在のctxにおける画面中心のXY座標とScale)\r\n\t//--------------------------------------------------\r\n\t\r\n\tconst info = function(){\r\n\t\tconst i = width * 0.5;\r\n\t\tconst j = height * 0.5;\r\n\t\tconst m = ctx.getTransform().invertSelf();\r\n\t\tconst x = m.a * i + m.c * j + m.e;\r\n\t\tconst y = m.b * i + m.d * j + m.f;\r\n\t\tconst s = 1 / Math.sqrt(m.a * m.a + m.b * m.b);\r\n\t\tstatus(\"X=\" + x.toFixed(8) + \"<br>Y=\" + y.toFixed(8) + \"<br>Scale=\" + s.toFixed(1) + \"[px/1]\");\r\n\t};\r\n\t\r\n\t//--------------------------------------------------\r\n\t//描画\r\n\t//--------------------------------------------------\r\n\t\r\n\t//画面に表示された画像(移動中に表示させる)\r\n\tconst canvas2 = document.createElement(\"canvas\");\r\n\tcanvas2.width = width;\r\n\tcanvas2.height = height;\r\n\tconst ctx2 = canvas2.getContext(\"2d\");\r\n\t\r\n\t//移動しながらの簡易表示\r\n\tconst movingUpdate = function(p0,p1){\r\n\t\t\r\n\t\t//IJ座標系で処理\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\tctx.clearRect(0, 0, width, height);\r\n\t\t\r\n\t\tpt.IJ(ctx,p0,p1);\r\n\t\t\r\n\t\tctx.drawImage(canvas2,0,0,width,height,0,0,width,height);\r\n\t\tctx.restore();\r\n\t\t\r\n\t\tdrawCenter(ctx,10,width,height);\r\n\t\t\r\n\t\t//XY座標系で画面中心位置の状態を求めて表示\r\n\t\tctx.save();\r\n\t\tpt.XY(ctx,p0,p1);\r\n\t\tinfo();\r\n\t\tctx.restore();\r\n\t};\r\n\t\r\n\t//移動完了後の再表示\r\n\tconst update = function(){\r\n\t\t//IJ座標系に直して全画面消去\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\tctx.clearRect(0, 0, width, height);\r\n\t\tctx.restore();\r\n\t\t\r\n\t\t//XY座標で描画\r\n\t\tdraw(ctx,width,height,getXY);\r\n\t\t\r\n\t\t//移動中表示用の画像保存\r\n\t\tctx2.clearRect(0, 0, width, height);\r\n\t\tctx2.drawImage(canvas,0,0);\r\n\r\n\t\t//情報表示\r\n\t\tdrawCenter(ctx,10,width,height);\r\n\t\tinfo();\r\n\t};\r\n\t\r\n\tupdate();\r\n};\r\n\r\nexport {Viewer};","/*\r\n\tWebGLによるマンデルブロ集合描画\r\n\tviewで与えられた四隅の範囲に基づいて描画したcanvasを返す\r\n\t\r\n\t2020/12/04 新規作成\r\n*/\r\n\r\n//view: 四隅のXY座標\r\nconst mandelbrot = function(width,height,view){\r\n\t\r\n\tconst cv = document.createElement(\"canvas\");\r\n\tcv.width = width;\r\n\tcv.height = height;\r\n\t\r\n\tconst gl = cv.getContext(\"webgl\");\r\n\r\n\tconst vsSrc = `\r\n\t\tattribute vec2 vij;\r\n\t\tattribute vec2 vxy;\r\n\r\n\t\t//フラグメントシェーダーに渡す頂点のXY座標(フラグメントシェーダーでは各ピクセル位置の座標に内挿された値が与えられる)\r\n\t\tvarying vec2 xy;\r\n\r\n\t\tvoid main(){\r\n\t\t\txy = vxy;\r\n\t\t\tgl_Position = vec4(vij, 0.0, 1.0);\r\n\t\t}\r\n\t`;\r\n\r\n\tconst fsSrc = `\r\n//\t\tprecision mediump float;\r\n\t\tprecision highp float;\r\n\r\n\t\t//バーテックスシェーダーから渡される値(各ピクセル位置のXY座標)\r\n\t\tvarying vec2 xy;\r\n\r\n\t\tint md(float x,float y){\r\n\t\t\tvec2 z = vec2(0.0, 0.0);\r\n\r\n\t\t\tfor(int i=0;i<500;i++){\r\n\t\t\t\tz = vec2(z.x * z.x - z.y * z.y + x, z.x * z.y * 2.0 + y);\r\n\r\n\t\t\t\tif(length(z) > 10.0) return i;\r\n\t\t\t}\r\n\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tvoid main(){\r\n\t\t\tfloat n = float(md(xy.x,xy.y));\r\n\t\t\tgl_FragColor = vec4(sin(n / 20.0), sin(n / 20.0), sin(n / 10.0), 1.0);\r\n\t\t}\r\n\t`;\r\n\r\n\t//頂点シェーダー\r\n\tconst vs = gl.createShader(gl.VERTEX_SHADER);\r\n\tgl.shaderSource(vs, vsSrc);\r\n\tgl.compileShader(vs);\r\n\r\n\t//フラグメントシェーダー\r\n\tconst fs = gl.createShader(gl.FRAGMENT_SHADER);\r\n\tgl.shaderSource(fs, fsSrc);\r\n\tgl.compileShader(fs);\r\n\r\n\t//WebGLProgramオブジェクトを作成\r\n\tconst program = gl.createProgram();\r\n\tgl.attachShader(program, vs);\r\n\tgl.attachShader(program, fs);\r\n\tgl.linkProgram(program);\r\n\tgl.useProgram(program);\r\n\r\n\t//頂点データ(canvas全体を覆うWebGLの座標)\r\n\tconst vij = gl.getAttribLocation(program, \"vij\");\r\n\tgl.enableVertexAttribArray(vij);\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\r\n\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\r\n\t\t-1.0, -1.0, //左下\r\n\t\t-1.0, 1.0, //左上\r\n\t\t1.0, -1.0, //右下\r\n\t\t1.0, 1.0 //右上\r\n\t]), gl.STATIC_DRAW);\r\n\tgl.vertexAttribPointer(vij, 2, gl.FLOAT, false, 0, 0);\r\n\r\n\t//各頂点に対応させるXY座標\r\n\tconst vxy = gl.getAttribLocation(program, \"vxy\");\r\n\tgl.enableVertexAttribArray(vxy);\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\r\n\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\r\n\t\tview.bl.x, view.bl.y, //左下\r\n\t\tview.tl.x, view.tl.y, //左上\r\n\t\tview.br.x, view.br.y, //右下\r\n\t\tview.tr.x, view.tr.y //右上\r\n\t]), gl.STATIC_DRAW);\r\n\tgl.vertexAttribPointer(vxy, 2, gl.FLOAT, false, 0, 0);\r\n\r\n\t//描画\r\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\t\r\n\treturn cv;\r\n};\r\n\r\nexport {mandelbrot};","/*\r\n\tmandelbrot\r\n\t2020/10/26 新規作成\r\n*/\r\n\r\nimport {Viewer} from \"./Viewer.js\";\r\nimport {mandelbrot} from \"./mandelbrot.js\";\r\n\r\nconst vw = new Viewer(document.getElementById(\"viewer\"),{\r\n\tx: {\r\n\t\tinit: -0.5,\r\n\t\tmin: -2,\r\n\t\tmax: 1,\r\n\t},\r\n\ty: {\r\n\t\tinit: 0.0,\r\n\t\tmin: -1.5,\r\n\t\tmax: 1.5,\r\n\t},\r\n\tscale: {\r\n\t\tinit: 100,\r\n\t\tmin: 100,\r\n\t\tmax: 200000000,\r\n\t},\r\n},function(ctx,width,height,getXY){\r\n\t\r\n\tconst view = {\r\n\t\ttl: getXY(0,0),\r\n\t\ttr: getXY(width,0),\r\n\t\tbr: getXY(width,height),\r\n\t\tbl: getXY(0,height),\r\n\t};\r\n\t\r\n\tctx.save();\r\n\tctx.resetTransform();\r\n\tctx.drawImage(mandelbrot(width,height,view),0,0);\r\n\tctx.restore();\r\n\t\r\n},function(str){\r\n\t\r\n\tdocument.getElementById(\"status\").innerHTML = str;\r\n\t\r\n});\r\n"]}